<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel do Gar√ßom</title>

<style>
body {
    font-family: Arial;
    background: #1e1e2f;
    color: white;
    text-align: center;
}

.mesas {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 20px;
}

.mesa {
    padding: 20px;
    background: #ff6b00;
    cursor: pointer;
    border-radius: 10px;
    font-weight: bold;
}

.mesa:hover {
    background: #e65c00;
}

#pedidoArea {
    display: none;
    background: #2c2c3c;
    padding: 20px;
    border-radius: 10px;
    margin: 20px;
}

select, input {
    padding: 8px;
    margin: 5px;
}

button {
    padding: 10px;
    background: #ff6b00;
    border: none;
    color: white;
    cursor: pointer;
}

ul {
    list-style: none;
    padding: 0;
}
</style>
</head>
<body>

<h2>üßæ Painel do Gar√ßom</h2>
<h3 id="nomeGarcom"></h3>

<div class="mesas" id="mesas"></div>

<div id="pedidoArea">
    <h3 id="mesaSelecionada"></h3>

    <select id="produto"></select>
    <input type="number" id="quantidade" value="1" min="1">

    <br>
    <button onclick="adicionarItem()">Adicionar Item</button>

    <h4>Itens do Pedido:</h4>
    <ul id="listaItens"></ul>

    <h3>Total: R$ <span id="total">0.00</span></h3>

    <button onclick="enviarPedido()">Enviar Pedido</button>
</div>

<script>
const usuario = { usuario: "garcom1", nivel: "garcom" };
document.getElementById("nomeGarcom").innerText = "Gar√ßom: " + usuario.usuario;

const mesasDiv = document.getElementById("mesas");
const pedidoArea = document.getElementById("pedidoArea");
const mesaSelecionada = document.getElementById("mesaSelecionada");
const listaItens = document.getElementById("listaItens");
const totalSpan = document.getElementById("total");
const selectProduto = document.getElementById("produto");

let mesaAtual = null;
let pedidoAtual = [];
let total = 0;

/* Criar mesas */
for (let i = 1; i <= 12; i++) {
    const div = document.createElement("div");
    div.className = "mesa";
    div.innerText = "Mesa " + i;
    div.onclick = () => abrirMesa(i);
    mesasDiv.appendChild(div);
}

/* Carregar produtos do ADMIN */
function carregarProdutos() {
    const produtos = JSON.parse(localStorage.getItem("produtos")) || [];
    selectProduto.innerHTML = "<option value=''>Selecione produto</option>";

    produtos.forEach((produto, index) => {
        if (produto.estoque > 0) {
            const option = document.createElement("option");
            option.value = index;
            option.text = `${produto.nome} - R$ ${produto.preco.toFixed(2)} (Estoque: ${produto.estoque})`;
            selectProduto.appendChild(option);
        }
    });
}

function abrirMesa(numero) {
    mesaAtual = numero;
    pedidoArea.style.display = "block";
    mesaSelecionada.innerText = "Pedido - Mesa " + numero;
    pedidoAtual = [];
    listaItens.innerHTML = "";
    total = 0;
    totalSpan.innerText = total.toFixed(2);
    carregarProdutos();
}

function adicionarItem() {
    const indexProduto = selectProduto.value;
    const quantidade = parseInt(document.getElementById("quantidade").value);

    if (indexProduto === "") {
        alert("Selecione um produto!");
        return;
    }

    const produtos = JSON.parse(localStorage.getItem("produtos")) || [];
    const produto = produtos[indexProduto];

    if (quantidade > produto.estoque) {
        alert("Estoque insuficiente!");
        return;
    }

    const subtotal = produto.preco * quantidade;

    pedidoAtual.push({
        nome: produto.nome,
        preco: produto.preco,
        quantidade: quantidade,
        setor: produto.categoria
    });

    total += subtotal;

    const li = document.createElement("li");
    li.innerText = `${produto.nome} x${quantidade} - R$ ${subtotal.toFixed(2)}`;
    listaItens.appendChild(li);

    totalSpan.innerText = total.toFixed(2);
}

function enviarPedido() {
    if (!mesaAtual || pedidoAtual.length === 0) {
        alert("Pedido inv√°lido!");
        return;
    }

    const pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
    const produtos = JSON.parse(localStorage.getItem("produtos")) || [];

    // Baixar estoque
    pedidoAtual.forEach(item => {
        const produto = produtos.find(p => p.nome === item.nome);
        if (produto) {
            produto.estoque -= item.quantidade;
        }
    });

    localStorage.setItem("produtos", JSON.stringify(produtos));

    pedidos.push({
        mesa: mesaAtual,
        garcom: usuario.usuario,
        itens: pedidoAtual,
        total: total,
        status: "pendente",
        data: new Date().toLocaleString()
    });

    localStorage.setItem("pedidos", JSON.stringify(pedidos));

    alert("Pedido enviado com sucesso!");

    pedidoArea.style.display = "none";
}

carregarProdutos();
</script>

</body>
</html>