<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Caixa</title>

<style>
body {
    font-family: Arial;
    background: #1e1e2f;
    color: white;
    padding: 20px;
}

.pedido {
    background: #2c2c3c;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 10px;
}

button {
    padding: 8px;
    background: #ff6b00;
    border: none;
    color: white;
    cursor: pointer;
    margin-top: 5px;
}

select, input {
    padding: 5px;
    margin-top: 5px;
}
</style>
</head>
<body>

<h2>ðŸ’° Sistema de Caixa</h2>

<div id="listaMesas"></div>

<script>
function carregarCaixa() {
    const pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
    const lista = document.getElementById("listaMesas");
    lista.innerHTML = "";

    pedidos.forEach((pedido, index) => {
        if (pedido.status === "pendente") {

            const div = document.createElement("div");
            div.classList.add("pedido");

            div.innerHTML = `
                <h3>Mesa ${pedido.mesa}</h3>
                <p><strong>GarÃ§om:</strong> ${pedido.garcom}</p>
                <ul>
                    ${pedido.itens.map(item =>
                        `<li>${item.nome} x${item.quantidade} - R$ ${(item.preco * item.quantidade).toFixed(2)}</li>`
                    ).join("")}
                </ul>
                <p><strong>Total:</strong> R$ ${pedido.total.toFixed(2)}</p>

                <label>Desconto (R$):</label><br>
                <input type="number" id="desconto${index}" value="0"><br>

                <label>Forma de Pagamento:</label><br>
                <select id="pagamento${index}">
                    <option value="Pix">Pix</option>
                    <option value="CartÃ£o">CartÃ£o</option>
                    <option value="Dinheiro">Dinheiro</option>
                </select><br>

                <button onclick="fecharMesa(${index})">Fechar Mesa</button>
            `;

            lista.appendChild(div);
        }
    });
}

function fecharMesa(index) {
    const pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
    const vendas = JSON.parse(localStorage.getItem("vendas")) || [];

    const desconto = parseFloat(document.getElementById("desconto" + index).value) || 0;
    const pagamento = document.getElementById("pagamento" + index).value;

    let totalFinal = pedidos[index].total - desconto;

    if (totalFinal < 0) totalFinal = 0;

    const venda = {
        mesa: pedidos[index].mesa,
        garcom: pedidos[index].garcom,
        totalOriginal: pedidos[index].total,
        desconto: desconto,
        totalFinal: totalFinal,
        pagamento: pagamento,
        data: new Date().toLocaleString()
    };

    vendas.push(venda);
    localStorage.setItem("vendas", JSON.stringify(vendas));

    pedidos[index].status = "fechado";
    localStorage.setItem("pedidos", JSON.stringify(pedidos));

    alert("Mesa fechada com sucesso!");
    carregarCaixa();
}

carregarCaixa();
setInterval(carregarCaixa, 3000);
</script>

</body>
</html>